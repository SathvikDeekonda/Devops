name: DevOps Build Notifier

on:
  push:
    branches: [ master ]
  pull_request:
    types: [opened, reopened, closed]
  create:
    branches: [ "*" ]
  delete:
    branches: [ "*" ]

jobs:
  notify:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Identify event
        run: echo "Triggered by ${{ github.event_name }} on branch ${{ github.ref_name }}"

      # ğŸ”¹ Branch Created
      - name: Notify branch creation
        if: ${{ github.event_name == 'create' }}
        run: |
          curl -s -X POST https://avril-parallelepipedous-unlethally.ngrok-free.dev/notify \
            -H "Content-Type: application/json" \
            -d "{\"repo\":\"${{ github.repository }}\",\"event\":\"create\",\"branch\":\"${{ github.ref_name }}\",\"pusher\":\"${{ github.actor }}\"}"

      # ğŸ”¹ Branch Deleted
      - name: Notify branch deletion
        if: ${{ github.event_name == 'delete' }}
        run: |
          curl -s -X POST https://avril-parallelepipedous-unlethally.ngrok-free.dev/notify \
            -H "Content-Type: application/json" \
            -d "{\"repo\":\"${{ github.repository }}\",\"event\":\"delete\",\"branch\":\"${{ github.ref_name }}\",\"pusher\":\"${{ github.actor }}\"}"

      # ğŸ”¹ Pull Request Opened / Closed
      - name: Notify pull request
        if: ${{ github.event_name == 'pull_request' }}
        run: |
          curl -s -X POST https://avril-parallelepipedous-unlethally.ngrok-free.dev/notify \
            -H "Content-Type: application/json" \
            -d "{\"repo\":\"${{ github.repository }}\",\"event\":\"pull_request\",\"branch\":\"${{ github.head_ref }}\",\"pusher\":\"${{ github.actor }}\",\"action\":\"${{ github.event.action }}\"}"

      # ğŸ”¹ Build Start (Push)
      - name: Notify build start
        if: ${{ github.event_name == 'push' }}
        run: |
          echo "ğŸš€ Sending build start notification..."
          curl -s -X POST https://avril-parallelepipedous-unlethally.ngrok-free.dev/notify \
            -H "Content-Type: application/json" \
            -d "{\"repo\":\"${{ github.repository }}\",\"event\":\"push\",\"status\":\"started\",\"branch\":\"${{ github.ref_name }}\",\"pusher\":\"${{ github.actor }}\",\"commit_message\":\"${{ github.event.head_commit.message }}\",\"commit_id\":\"${{ github.event.head_commit.id }}\"}"

      # ğŸ”¹ Simulate Build (you can replace this with real build steps)
      - name: Simulate build
        if: ${{ github.event_name == 'push' }}
        run: |
          echo "ğŸ—ï¸ Building project..."
          sleep 5
          echo "âœ… Build completed successfully!"

      # ğŸ”¹ Build Completion
      - name: Notify build completion
        if: ${{ github.event_name == 'push' && always() }}
        run: |
          echo "ğŸ“£ Sending build completion notification..."
          curl -s -X POST https://avril-parallelepipedous-unlethally.ngrok-free.dev/notify \
            -H "Content-Type: application/json" \
            -d "{\"repo\":\"${{ github.repository }}\",\"event\":\"push\",\"status\":\"${{ job.status }}\",\"url\":\"https://github.com/${{ github.repository }}/actions/runs/${{ github.run_id }}\",\"branch\":\"${{ github.ref_name }}\",\"pusher\":\"${{ github.actor }}\",\"commit_message\":\"${{ github.event.head_commit.message }}\",\"commit_id\":\"${{ github.event.head_commit.id }}\"}"
